<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>School Prospecting Table</title>
  <!-- Flowbite CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 p-4">

  <div class="container mx-auto">
    <h1 class="text-2xl font-bold mb-4">Filtered School List</h1>
    <table id="export-table" class="w-full text-sm text-left text-gray-500 dark:text-gray-400 border">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
        <tr>
          <th class="px-4 py-2">Name</th>
          <th class="px-4 py-2">School Type</th>
          <th class="px-4 py-2">Enrollment</th>
          <th class="px-4 py-2">Bachelor's Offered</th>
          <th class="px-4 py-2">Retention Rate</th>
          <th class="px-4 py-2">Graduation Rate</th>
        </tr>
      </thead>
      <tbody id="table-body">
        <!-- Data rows will be inserted here -->
      </tbody>
    </table>
  </div>

  <script>
    // Replace with your actual API key.
    const API_KEY = 'caof23MEffltOqJfUdFLcPdujqPtmABupKlWswZ8';
    const baseUrl = 'https://api.data.gov/ed/collegescorecard/v1/schools';

    // Set up parameters based on your filtering criteria.
    const params = new URLSearchParams({
      api_key: API_KEY,
      // For school type: 1=Public, 2=Private Nonprofit, 3=Private For-Profit.
      'school.control': '1,2,3',
      // Example: filter by enrollment between 1000 and 5000 students.
      'latest.student.size__range': '1000..5000',
      // Uncomment and adjust the following line if you want to filter by retention rate.
      // 'latest.student.retention_rate__range': '0.7..',
      
      // Specify the fields you want in the response.
      fields: 'id,school.name,school.control,latest.student.size,latest.completion.rate,latest.student.retention_rate'
    });

    fetch(`${baseUrl}?${params.toString()}`)
      .then(response => response.json())
      .then(data => {
        console.log("Data from API:", data);
        const tableBody = document.getElementById('table-body');
        
        // Check if the API returned an error.
        if (data.error) {
          tableBody.innerHTML = `<tr><td colspan="6" class="px-4 py-2 text-red-600">API Error: ${data.error.message}</td></tr>`;
          console.error("API Error:", data.error);
          return;
        }
        
        // Check that data.results exists and is an array.
        if (!data.results || !Array.isArray(data.results) || data.results.length === 0) {
          tableBody.innerHTML = '<tr><td colspan="6" class="px-4 py-2 text-red-600">No results found.</td></tr>';
          console.error("No results found in API response:", data);
          return;
        }

        data.results.forEach(school => {
          const tr = document.createElement('tr');
          tr.classList.add("hover:bg-gray-50", "dark:hover:bg-gray-800", "cursor-pointer");

          // Extract fields from the API response.
          const schoolName = school['school.name'] || 'N/A';
          const schoolControl = school['school.control'];
          const enrollment = school['latest.student.size'] || 'N/A';
          const graduationRate = school['latest.completion.rate'];
          const retentionRate = school['latest.student.retention_rate'];
          
          // Convert numeric school control value to text.
          let schoolType = 'Unknown';
          if (schoolControl === 1) {
            schoolType = 'Public';
          } else if (schoolControl === 2) {
            schoolType = 'Private Nonprofit';
          } else if (schoolControl === 3) {
            schoolType = 'Private For-Profit';
          }
          
          // Placeholder for Bachelor's degree offered. Replace with actual field as needed.
          const bachelorsOffered = 'Yes/No'; 

          // Format percentages (assuming API returns values as decimals, e.g., 0.8 for 80%).
          const formattedRetention = retentionRate ? (retentionRate * 100).toFixed(1) + '%' : 'N/A';
          const formattedGraduation = graduationRate ? (graduationRate * 100).toFixed(1) + '%' : 'N/A';

          tr.innerHTML = `
            <td class="px-4 py-2 font-medium text-gray-900 dark:text-white">${schoolName}</td>
            <td class="px-4 py-2">${schoolType}</td>
            <td class="px-4 py-2">${enrollment}</td>
            <td class="px-4 py-2">${bachelorsOffered}</td>
            <td class="px-4 py-2">${formattedRetention}</td>
            <td class="px-4 py-2">${formattedGraduation}</td>
          `;
          tableBody.appendChild(tr);
        });
      })
      .catch(error => console.error('Error fetching data:', error));
  </script>

  <!-- Flowbite JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/1.6.5/flowbite.min.js"></script>
</body>
</html>
